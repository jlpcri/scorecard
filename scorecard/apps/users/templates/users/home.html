{% extends 'core/base.html' %}
{% load staticfiles %}

{% block extrahead %}


<link rel="stylesheet" type="text/css" href="{% static 'jquery-data-tables/css/jquery.dataTables.min.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'jquery-data-tables/css/jquery-ui.min.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'jquery-data-tables/syntax/shCore.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'jquery-data-tables/css/demo.css' %}">

<link rel="stylesheet" type="text/css" href="{% static 'd3charts/d3_west_charts.css' %} ">
<link rel="stylesheet" type="text/css" href="{% static 'd3charts/main.css' %} ">

<script type="text/javascript" language="javascript" src="{% static 'common/jquery/1.10.2/jquery.min.js' %}"></script>
<script type="text/javascript" language="javascript" src="{% static 'jquery-data-tables/js/jquery-ui.min.js' %}"></script>

<script type="text/javascript" language="javascript" src="{% static 'jquery-data-tables/js/jquery.dataTables.js' %}"></script>
<script type="text/javascript" language="javascript" src="{% static 'jquery-data-tables/syntax/shCore.js' %}"></script>
<script type="text/javascript" language="javascript" src="{% static 'jquery-data-tables/js/demo.js' %}"></script>

<script type="text/javascript" language="javascript" src="{% static 'd3charts/d3.v3.min.js' %}"></script>
<script type="text/javascript" language="javascript" src="{% static 'd3charts/colorbrewer.js' %}"></script>
<script type="text/javascript" language="javascript" src="{% static 'd3charts/date.js' %}"></script>


<style>

    #dnd_div_home {
        border: 1px solid black;
        width: 200px;
        height: 25px;
        margin-left: auto;
        margin-right: auto;
        text-align: center;
    }

    .metrics_table {
        border: 1px solid lightgray;
        width: 100%;
    }

    .metrics_thead {
        border: 0px solid lightgray;
        width: 100% !important;
    }

    .metrics_tbody {
        border: 0px solid lightgray;
        width: 100% !important;
    }

    .td_title {
        border: 1px solid lightgray;
        text-align: center;
    }

    .td_metrics_date_table {
        border: 1px solid lightgray;
        width: 250px !important;
        padding-left: 4px;
        padding-right: 1px;
        margin-left: 0px;
        margin-right: 0px;
        overflow-y:hidden;
    }

    .td_metrics_table {
        border: 1px solid lightgray;
        width: 100%;
        padding-left: 1px;
        padding-right: 1px;
    }

    .td_metrics_test_lab {
        border: 0px solid lightgray;
        padding-left: 1px;
        padding-right: 4px;
    }

    .legend_metrics {
        font-weight: bold;
        font-size: 18px;
        font-family: "Helvetica Neue", HelveticaNeue, Arial, Helvetica, sans-serif;
        color: #333;
    }

    .show_hide_table {
        width:80%;
        margin-left:auto;
        margin-right:auto;
    }

    .td_show_hide_sub_table {
        border:0px solid blue;
        width: 300px;
        height: 35px;
        white-space: nowrap;
        padding-left: 10px;
        padding-right: 10px;
    }

    .td_show_hide_table {
        border:1px solid darkgray;
        white-space: nowrap;
        padding-left: 10px;
        padding-right: 10px;
    }

    .td1_show_hide_table {
        border:0px solid black;
        width:200px;
        min-width:190px;
        white-space: nowrap;
        padding-left:20px;
        padding-right:20px;
    }

    .td2_show_hide_table {
        border:0px solid black;
        width:200px;
        min-width:190px;
        white-space: nowrap;
        padding-left:20px;
        padding-right:20px;
    }

    .west_container {
        min-width:60%;
    }

</style>

{% endblock extrahead %}

{% block title %} Home {% endblock %}

{% block body %}
<div class="container west_container">
    <h1>Score Card</h1>
    <!--
    <h4> Scorecard, now available with QEI team: </h4>
    <ul>
        <li>A strategy performance management tool</li>
        <li>A semi-standard structured report</li>
        <li>Supported by design methods and automation tools</li>
        <li>Used by team managers to keep track of execution of activities by the staff within their control</li>
        <li>Monitor the consequences arising from staff actions</li>
    </ul>
    -->
</div>

<form action="." method="POST">

    {% csrf_token %}

    <br><br><br>

    <div class="container west_container">
        <section>
            <div id="west_table_wrapper_div" class="dataTables_wrapper no-footer table-responsive">
                <div class="dataTables_scroll">
                    <table id="all_data_table" class="display nowrap" cellspacing="0" style="border:1px solid lightgray;">
                        <thead></thead>
                        <tbody>
                        <tr>

                            <!-- display just the date column -->
                            {% comment %}
                            <td id="td_date_table" class="td_metrics_date_table">

                                <fieldset>
                                    <legend class="legend_metrics">&nbsp;&nbsp;&nbsp;</legend>

                                    <table id="date_table" class="display nowrap metrics_table" cellspacing="0">
                                        <thead class="metrics_thead">
                                        <tr>
                                            <th style="width:400px;">Date</th>
                                        </tr>
                                        </thead>
                                        <tbody class="metrics_tbody">
                                        {% for qa in qa_data %}
                                        <tr>
                                            <td>{{ qa.created|date }}</td>
                                        </tr>
                                        {% endfor %}
                                        </tbody>
                                    </table>
                                </fieldset>

                            </td>
                            {% endcomment %}
                            {% comment %}
                            <td id="td_product_quality_table" class="td_metrics_table">

                                <fieldset>
                                    <legend id="pq_legend" class="legend_metrics">Product Quality</legend>

                                    <table id="product_quality_table" class="display nowrap metrics_table" cellspacing="0">
                                        <thead class="metrics_thead">
                                        <tr id="pq_th_r1">
                                            <th id="pq_th_r1_1" class="col-md-1"><strong>Staffs</strong></th>
                                            <th id="pq_th_r1_2" class="col-md-2"><strong>Active Projects</strong></th>
                                            <th id="pq_th_r1_3" class="col-md-2"><strong>Active Tickets</strong></th>
                                            <th id="pq_th_r1_4" class="col-md-2"><strong>Avg Throughput</strong></th>
                                            <th id="pq_th_r1_5" class="col-md-2"><strong>Total Costs</strong></th>
                                        </tr>
                                        </thead>
                                        <tbody class="metrics_tbody">
                                        {% for pq in pq_data %}
                                        <tr>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ pq.staffs }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ pq.active_projects }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ pq.active_tickets }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ pq.avg_throughput|floatformat:2 }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ pq.total_operational_cost }}</td>
                                        </tr>
                                        {% endfor %}
                                        </tbody>
                                    </table>

                                </fieldset>

                            </td>
                            {% endcomment %}

                            <td id="td_quality_assurance_table" class="td_metrics_table">

                                <fieldset>
                                    <legend id="qa_legend" class="legend_metrics">Quality Assurance</legend>

                                    <table id="quality_assurance_table" class="display nowrap metrics_table" cellspacing="0">
                                        <thead class="metrics_thead">
                                        <tr id="qa_th_r1">
                                            <th id="qa_th_r1_0"  class="col-md-3"><strong>Date</strong></th>
                                            <th id="qa_th_r1_1"  class="col-md-1"><strong>Staffs</strong></th>
                                            <th id="qa_th_r1_2"  class="col-md-2"><strong>Active Projects</strong></th>
                                            <th id="qa_th_r1_3"  class="col-md-2"><strong>Active Tickets</strong></th>
                                            <th id="qa_th_r1_4"  class="col-md-2"><strong>Avg Throughput</strong></th>
                                            <th id="qa_th_r1_5"  class="col-md-2"><strong>Total Costs</strong></th>
                                            <th id="qa_th_r1_6"  class="col-md-2"><strong>Team Initiative</strong></th>
                                            <th id="qa_th_r1_7"  class="col-md-2"><strong>Ticket Backlog</strong></th>
                                            <th id="qa_th_r1_8"  class="col-md-2"><strong>Ticket Prep</strong></th>
                                            <th id="qa_th_r1_9"  class="col-md-2"><strong>Ticket Execution</strong></th>
                                            <th id="qa_th_r1_10" class="col-md-2"><strong>Tickets Closed</strong></th>
                                            <th id="qa_th_r1_11" class="col-md-2"><strong>Project Backlog</strong></th>
                                            <th id="qa_th_r1_12" class="col-md-2"><strong>Project Prep</strong></th>
                                            <th id="qa_th_r1_13" class="col-md-2"><strong>Project Execution</strong></th>
                                            <th id="qa_th_r1_14" class="col-md-2"><strong>Project Closed</strong></th>
                                            <th id="qa_th_r1_15" class="col-md-2"><strong>TC Manual Dev</strong></th>
                                            <th id="qa_th_r1_16" class="col-md-2"><strong>TC Manual Dev Time</strong></th>
                                            <th id="qa_th_r1_17" class="col-md-2"><strong>TC Manual Execution</strong></th>
                                            <th id="qa_th_r1_18" class="col-md-2"><strong>TC Manual Execution Time</strong></th>
                                            <th id="qa_th_r1_19" class="col-md-2"><strong>TC Auto Dev</strong></th>
                                            <th id="qa_th_r1_20" class="col-md-2"><strong>TC Auto Dev Time</strong></th>
                                            <th id="qa_th_r1_21" class="col-md-2"><strong>TC Auto Execution</strong></th>
                                            <th id="qa_th_r1_22" class="col-md-2"><strong>TC Auto Execution Time</strong></th>
                                            <th id="qa_th_r1_23" class="col-md-2"><strong>Defects Caught</strong></th>
                                            <th id="qa_th_r1_24" class="col-md-2"><strong>UAT Defects Not Prevented</strong></th>
                                            <th id="qa_th_r1_25" class="col-md-2"><strong>Standard Violated</strong></th>
                                            <th id="qa_th_r1_26" class="col-md-2"><strong>Average Time Frame</strong></th>
                                        </tr>
                                        </thead>
                                        <tbody class="metrics_tbody">
                                        {% for qa in qa_data %}
                                        <tr>
                                            <td>{{ qa.created|date }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ qa.staffs }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ qa.active_projects }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ qa.active_tickets }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ qa.avg_throughput|floatformat:2 }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ qa.total_operational_cost }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ qa.team_initiative }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ qa.ticket_backlog }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ qa.ticket_prep }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ qa.ticket_execution }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ qa.ticket_closed }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ qa.project_backlog }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ qa.project_prep }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ qa.project_execution }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ qa.project_closed }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ qa.tc_manual_dev }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ qa.tc_manual_dev_time }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ qa.tc_manual_execution }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ qa.tc_manual_execution_time }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ qa.tc_auto_dev }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ qa.tc_auto_dev_time }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ qa.tc_auto_execution }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ qa.tc_auto_execution_time }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ qa.defect_caught }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ qa.uat_defects_not_prevented }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ qa.standards_violated }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ qa.avg_time_frame }}</td>
                                        </tr>
                                        {% endfor %}
                                        </tbody>
                                    </table>
                                </fieldset>

                            </td>

                            <td id="td_quality_innovation_table" class="td_metrics_table">

                                <fieldset>
                                    <legend id="qi_legend" class="legend_metrics">Quality Innovation</legend>

                                    <table id="quality_innovation_table" class="display nowrap metrics_table" cellspacing="0">
                                        <thead class="metrics_thead">
                                        <tr id="qi_th_r1">
                                            <th id="qi_th_r1_0"  class="col-md-3"><strong>Date</strong></th>
                                            <th id="qi_th_r1_1"  class="col-md-3"><strong>Staffs</strong></th>
                                            <th id="qi_th_r1_2"  class="col-md-2"><strong>Story Points Backlog</strong></th>
                                            <th id="qi_th_r1_3"  class="col-md-2"><strong>Story Points Prep</strong></th>
                                            <th id="qi_th_r1_4"  class="col-md-2"><strong>Story Points Execution</strong></th>
                                            <th id="qi_th_r1_5"  class="col-md-2"><strong>Avg Team Size</strong></th>
                                            <th id="qi_th_r1_6"  class="col-md-2"><strong>Total Costs</strong></th>
                                            <th id="qi_th_r1_7"  class="col-md-2"><strong>Unit Tests Dev</strong></th>
                                            <th id="qi_th_r1_8"  class="col-md-2"><strong>Unit Tests Coverage</strong></th>
                                            <th id="qi_th_r1_9"  class="col-md-2"><strong>Documentation Coverage</strong></th>
                                            <th id="qi_th_r1_10" class="col-md-2"><strong>Defects in Dev</strong></th>
                                            <th id="qi_th_r1_11" class="col-md-2"><strong>Elicitation Analysis Time</strong></th>
                                            <th id="qi_th_r1_12" class="col-md-2"><strong>Revisions</strong></th>
                                            <th id="qi_th_r1_13" class="col-md-2"><strong>Acvtive Projects</strong></th>
                                            <th id="qi_th_r1_14" class="col-md-2"><strong>UAT Defects Not Prevented</strong></th>
                                            <th id="qi_th_r1_15" class="col-md-2"><strong>Pheme Manual Tests</strong></th>
                                            <th id="qi_th_r1_16" class="col-md-2"><strong>Pheme Auto Tests</strong></th>
                                            <th id="qi_th_r1_17" class="col-md-2"><strong>Visilog TXL Parsed</strong></th>
                                            <th id="qi_th_r1_18" class="col-md-2"><strong>Visilog TXL Schema Violation</strong></th>
                                            <th id="qi_th_r1_19" class="col-md-2"><strong>Average Throughput</strong></th>
                                        </tr>
                                        </thead>
                                        <tbody class="metrics_tbody">
                                        {% for qi in qi_data %}
                                        <tr>
                                            <td>{{ qi.created|date }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ qi.staffs }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ qi.story_points_backlog }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ qi.story_points_prep }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ qi.story_points_execution }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ qi.avg_team_size }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ qi.total_operational_cost }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ qi.unit_tests_dev }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ qi.unit_tests_coverage }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ qi.documentation_coverage }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ qi.defects_in_dev }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ qi.elicitation_analysis_time }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ qi.revisions }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ qi.active_projects }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ qi.uat_defects_not_prevented }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ qi.pheme_manual_tests }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ qi.pheme_auto_tests }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ qi.visilog_txl_parsed }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ qi.visilog_txl_schema_violation }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ qi.avg_throughput }}</td>
                                        </tr>
                                        {% endfor %}
                                        </tbody>
                                    </table>
                                </fieldset>

                            </td>

                            <td id="td_requirements_engineering_table" class="td_metrics_table">

                                <fieldset>
                                    <legend id="re_legend" class="legend_metrics">Requirements Engineering</legend>

                                    <table id="requirements_engineering_table" class="display nowrap metrics_table" cellspacing="0">
                                        <thead class="metrics_thead">
                                        <tr id="re_th_r1">
                                            <th id="re_th_r1_0"  class="col-md-3"><strong>Date</strong></th>
                                            <th id="re_th_r1_1"  class="col-md-1"><strong>Staffs</strong></th>
                                            <th id="re_th_r1_2"  class="col-md-2"><strong>Active Projects</strong></th>
                                            <th id="re_th_r1_3"  class="col-md-2"><strong>Elicitation Analysis</strong></th>
                                            <th id="re_th_r1_4"  class="col-md-2"><strong>Avg Throughput</strong></th>
                                            <th id="re_th_r1_5"  class="col-md-2"><strong>Total Costs</strong></th>
                                            <th id="re_th_r1_6"  class="col-md-2"><strong>Backlog</strong></th>
                                            <th id="re_th_r1_7"  class="col-md-2"><strong>Team Initiative</strong></th>
                                            <th id="re_th_r1_8"  class="col-md-2"><strong>Revisions</strong></th>
                                            <th id="re_th_r1_9"  class="col-md-2"><strong>SLAS Missed</strong></th>
                                            <th id="re_th_r1_10" class="col-md-2"><strong>Rework External Time</strong></th>
                                            <th id="re_th_r1_11" class="col-md-2"><strong>Travel Costs</strong></th>
                                            <th id="re_th_r1_12" class="col-md-2"><strong>Gross Available Time</strong></th>
                                            <th id="re_th_r1_13" class="col-md-2"><strong>Efficiency</strong></th>
                                            <th id="re_th_r1_14" class="col-md-2"><strong>Rework External Costs</strong></th>
                                        </tr>
                                        </thead>
                                        <tbody class="metrics_tbody">
                                        {% for re in re_data %}
                                        <tr>
                                            <td>{{ re.created|date }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ re.staffs }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ re.active_projects }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ re.elicitation_analysis_time }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ re.avg_throughput }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ re.total_operational_cost }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ re.backlog }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ re.team_initiative }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ re.revisions }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ re.slas_missed }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ re.rework_external_time }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ re.travel_cost }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ re.gross_available_time }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ re.efficiency }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ re.rework_external_cost }}</td>
                                        </tr>
                                        {% endfor %}
                                        </tbody>
                                    </table>
                                </fieldset>

                            </td>

                            <td id="td_test_engineering_table" class="td_metrics_table">

                                <fieldset>
                                    <legend id="te_legend" class="legend_metrics">Test Engineering</legend>

                                    <table id="test_engineering_table" class="display nowrap metrics_table" cellspacing="0">
                                        <thead class="metrics_thead">
                                        <tr id="te_th_r1">
                                            <th id="te_th_r1_0"  class="col-md-3"><strong>Date</strong></th>
                                            <th id="te_th_r1_1"  class="col-md-1"><strong>Staffs</strong></th>
                                            <th id="te_th_r1_2"  class="col-md-2"><strong>Active Projects</strong></th>
                                            <th id="te_th_r1_3"  class="col-md-2"><strong>Active Tickets</strong></th>
                                            <th id="te_th_r1_4"  class="col-md-2"><strong>Avg Throughput</strong></th>
                                            <th id="te_th_r1_5"  class="col-md-2"><strong>License Costs</strong></th>
                                            <th id="te_th_r1_6"  class="col-md-2"><strong>Team Initiative</strong></th>
                                            <th id="te_th_r1_7"  class="col-md-2"><strong>Ticket Backlog</strong></th>
                                            <th id="te_th_r1_8"  class="col-md-2"><strong>Ticket Prep</strong></th>
                                            <th id="te_th_r1_9"  class="col-md-2"><strong>Ticket Execution</strong></th>
                                            <th id="te_th_r1_10" class="col-md-2"><strong>Tickets Closed</strong></th>
                                            <th id="te_th_r1_11" class="col-md-2"><strong>Project Backlog</strong></th>
                                            <th id="te_th_r1_12" class="col-md-2"><strong>Project Prep</strong></th>
                                            <th id="te_th_r1_13" class="col-md-2"><strong>Project Execution</strong></th>
                                            <th id="te_th_r1_14" class="col-md-2"><strong>Project Closed</strong></th>
                                            <th id="te_th_r1_15" class="col-md-2"><strong>TC Manual Dev</strong></th>
                                            <th id="te_th_r1_16" class="col-md-2"><strong>TC Manual Dev Time</strong></th>
                                            <th id="te_th_r1_17" class="col-md-2"><strong>TC Manual Execution</strong></th>
                                            <th id="te_th_r1_18" class="col-md-2"><strong>TC Manual Execution Time</strong></th>
                                            <th id="te_th_r1_19" class="col-md-2"><strong>TC Auto Dev</strong></th>
                                            <th id="te_th_r1_20" class="col-md-2"><strong>TC Auto Dev Time</strong></th>
                                            <th id="te_th_r1_21" class="col-md-2"><strong>TC Auto Execution</strong></th>
                                            <th id="te_th_r1_22" class="col-md-2"><strong>TC Auto Execution Time</strong></th>
                                            <th id="te_th_r1_23" class="col-md-2"><strong>Defects Caught</strong></th>
                                            <th id="te_th_r1_24" class="col-md-2"><strong>UAT Defects Not Prevented</strong></th>
                                            <th id="te_th_r1_25" class="col-md-2"><strong>Standard Violated</strong></th>
                                            <th id="te_th_r1_26" class="col-md-2"><strong>Average Time Frame</strong></th>
                                        </tr>
                                        </thead>
                                        <tbody class="metrics_tbody">
                                        {% for te in te_data %}
                                        <tr>
                                            <td>{{ te.created|date }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ te.staffs }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ te.active_projects }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ te.active_tickets }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ te.avg_throughput|floatformat:2 }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ te.total_operational_cost }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ te.team_initiative }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ te.ticket_backlog }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ te.ticket_prep }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ te.ticket_execution }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ te.ticket_closed }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ te.project_backlog }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ te.project_prep }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ te.project_execution }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ te.project_closed }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ te.tc_manual_dev }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ te.tc_manual_dev_time }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ te.tc_manual_execution }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ te.tc_manual_execution_time }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ te.tc_auto_dev }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ te.tc_auto_dev_time }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ te.tc_auto_execution }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ te.tc_auto_execution_time }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ te.defect_caught }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ te.uat_defects_not_prevented }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ te.standards_violated }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ te.avg_time_frame }}</td>
                                        </tr>
                                        {% endfor %}
                                        </tbody>
                                    </table>
                                </fieldset>

                            </td>

                            <td id="td_test_lab_table" class="td_metrics_test_lab">

                                <fieldset>
                                    <legend id="tl_legend" class="legend_metrics">Test Lab</legend>

                                    <table id="test_lab_table" class="display nowrap metrics_table" cellspacing="0">
                                        <thead class="metrics_thead">
                                        <tr id="tl_th_r1">
                                            <th id="tl_th_r1_0" class="col-md-3"><strong>Date</strong></th>
                                            <th id="tl_th_r1_1" class="col-md-1"><strong>Staffs</strong></th>
                                            <th id="tl_th_r1_2" class="col-md-2"><strong>Tickets Received</strong></th>
                                            <th id="tl_th_r1_3" class="col-md-2"><strong>Tickets Closed</strong></th>
                                            <th id="tl_th_r1_4" class="col-md-2"><strong>Virtual Machines</strong></th>
                                            <th id="tl_th_r1_5" class="col-md-2"><strong>Physical Machines</strong></th>
                                            <th id="tl_th_r1_6" class="col-md-2"><strong>Power UPS A</strong></th>
                                            <th id="tl_th_r1_7" class="col-md-2"><strong>Power UPS B</strong></th>
                                            <th id="tl_th_r1_8" class="col-md-2"><strong>License Costs</strong></th>
                                        </tr>
                                        </thead>
                                        <tbody class="metrics_tbody">
                                        {% for tl in tl_data %}
                                        <tr>
                                            <td>{{ tl.created|date }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ tl.staffs }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ tl.tickets_received }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ tl.tickets_closed }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ tl.virtual_machines }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ tl.physical_machines }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ tl.power_consumption_ups_a }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ tl.power_consumption_ups_b }}</td>
                                            <td draggable="true" ondragstart="drag_home(event)">{{ tl.license_cost }}</td>
                                        </tr>
                                        {% endfor %}
                                        </tbody>
                                    </table>
                                </fieldset>

                            </td>

                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>
    </div>

    <div class="container west_container">

        <section>
            <div class="dataTables_wrapper no-footer table-responsive">
            <div class="dataTables_scroll">
                <table class="display nowrap show_hide_table" cellspacing="0">
                    <thead></thead>
                    <tbody>

                    <tr>
                        <!--
                        <td class="td_show_hide_table">

                            <table class="td_show_hide_sub_table">
                                <tbody>
                                <tr>
                                    <td class="td1_show_hide_table">
                                        <input id="pq_show_hide_checkbox" type="checkbox" onchange="on_change_show_hide_metrics_table(event)" checked/>Product Quality
                                    </td>
                                    <td class="td2_show_hide_table">
                                        <input id="pq_show_hide_dialog_button" type="button" id="pq_show_hide_columns_button" value="Show/Hide Columns" onclick="on_click_show_hide_columns_dialog(event)">
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </td>
                        -->
                        <td class="td_show_hide_table">
                            <table class="td_show_hide_sub_table">
                                <tbody>
                                <tr>
                                    <td class="td1_show_hide_table">
                                        <input id="qa_show_hide_checkbox" type="checkbox" onchange="on_change_show_hide_metrics_table(event)" checked/>Quality Assurance
                                    </td>
                                    <td class="td2_show_hide_table">
                                        <input id="qa_show_hide_dialog_button" type="button" id="qa_show_hide_columns_button" value="Show/Hide Columns" onclick="on_click_show_hide_columns_dialog(event)">
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </td>

                        <td class="td_show_hide_table">
                            <table class="td_show_hide_sub_table">
                                <tbody>
                                <tr>
                                    <td class="td1_show_hide_table">
                                        <input id="qi_show_hide_checkbox" type="checkbox" onchange="on_change_show_hide_metrics_table(event)" checked/>Quality Innovation
                                    </td>
                                    <td class="td2_show_hide_table">
                                        <input id="qi_show_hide_dialog_button" type="button" id="qi_show_hide_columns_button" value="Show/Hide Columns" onclick="on_click_show_hide_columns_dialog(event)">
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </td>

                        <td class="td_show_hide_table">
                            <table class="td_show_hide_sub_table">
                                <tbody>
                                <tr>
                                    <td class="td1_show_hide_table">
                                        <input id="re_show_hide_checkbox" type="checkbox" onchange="on_change_show_hide_metrics_table(event)" checked/>Requirements Engineering
                                    </td>
                                    <td class="td2_show_hide_table">
                                        <input id="re_show_hide_dialog_button" type="button" id="re_show_hide_columns_button" value="Show/Hide Columns" onclick="on_click_show_hide_columns_dialog(event)">
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </td>

                        <td class="td_show_hide_table">
                            <table class="td_show_hide_sub_table">
                                <tbody>
                                <tr>
                                    <td class="td1_show_hide_table">
                                        <input id="te_show_hide_checkbox" type="checkbox" onchange="on_change_show_hide_metrics_table(event)" checked/>Test Engineering
                                    </td>
                                    <td class="td2_show_hide_table">
                                        <input id="te_show_hide_dialog_button" type="button" id="te_show_hide_columns_button" value="Show/Hide Columns" onclick="on_click_show_hide_columns_dialog(event)">
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </td>

                        <td class="td_show_hide_table">
                            <table class="td_show_hide_sub_table">
                                <tbody>
                                <tr>
                                    <td class="td1_show_hide_table">
                                        <input id="tl_show_hide_checkbox" type="checkbox" onchange="on_change_show_hide_metrics_table(event)" checked/>Test Lab
                                    </td>
                                    <td class="td2_show_hide_table">
                                        <input id="tl_show_hide_dialog_button" type="button" id="tl_show_hide_columns_button" value="Show/Hide Columns" onclick="on_click_show_hide_columns_dialog(event)">
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
            </div>
        </section>

    </div>

    <br>

    <div id="dialog" style="display:none;"></div>
    <br>

    <div class="container">

        <section>
            <div id="dnd_div_home" class="dnd_button_div" ondrop="drop_home(event)" ondragover="allow_drop_home(event)">Drop
                Target
            </div>
        </section>

    </div>

    <br>

    <div class="container west_container">
        <section>
            <div class="dataTables_wrapper no-footer table-responsive">
                <div class="dataTables_scroll">
                    <table class="chart_table">
                        <tr id="home_chart_row"></tr>
                    </table>
                </div>
            </div>
        </section>
    </div>

    <br>

</form>

{% endblock %}

{% block endscript %}

<script type="text/javascript">

    var home_primary_date_time_column = 0;
    var home_next_chart_id = 0;
    var home_dnd_charts_list = [];
    var home_dnd_id = "";
    var home_chart_svg_prefix = "home_chart_svg_";

    var home_pq_all_column_names_list = [];
    var home_qa_all_column_names_list = [];
    var home_qi_all_column_names_list = [];
    var home_re_all_column_names_list = [];
    var home_te_all_column_names_list = [];
    var home_tl_all_column_names_list = [];

    // save the original number of columns since I need this information when hiding the last column in the table
    var home_pq_number_of_columns;
    var home_qa_number_of_columns;
    var home_qi_number_of_columns;
    var home_re_number_of_columns;
    var home_te_number_of_columns;
    var home_tl_number_of_columns;

    // list of columns numbers the user has selected to hide
    var home_pq_hide_column_list = [];
    var home_qa_hide_column_list = [];
    var home_qi_hide_column_list = [];
    var home_re_hide_column_list = [];
    var home_te_hide_column_list = [];
    var home_tl_hide_column_list = [];

    // comma separated list of columns to hide
    var home_pq_hide_columns_json = '{{ pq_user_hide_list | safe }}';
    var home_qa_hide_columns_json = '{{ qa_user_hide_list | safe }}';
    var home_qi_hide_columns_json = '{{ qi_user_hide_list | safe }}';
    var home_re_hide_columns_json = '{{ re_user_hide_list | safe }}';
    var home_te_hide_columns_json = '{{ te_user_hide_list | safe }}';
    var home_tl_hide_columns_json = '{{ tl_user_hide_list | safe }}';

    // var table_id = "work_week_table";
    var selected_show_hide_table = "";

    (function () {

        if (window.jQuery) {
            // alert("297 JQuery is loaded.");
        } else {
            alert("299 JQuery is not loaded.");
        }

        $(document).ready(function () {

            if (jQuery().dataTable) {
                // alert("jQuery Datatables is loaded.");

                build_column_names_lists();

                // initialize_metrics_table("date_table", "dd");
                //initialize_metrics_table("product_quality_table", "pq");
                initialize_metrics_table("quality_assurance_table", "qa");
                initialize_metrics_table("quality_innovation_table", "qi");
                initialize_metrics_table("requirements_engineering_table", "re");
                initialize_metrics_table("test_engineering_table", "te");
                initialize_metrics_table("test_lab_table", "tl");

                initialize_main_table();

            } else {
                alert("library is not loaded");
            }

        });

    })(jQuery);

    function initialize_main_table() {

        $('#all_data_table').DataTable({
            "scrollY": 200,
            "scrollX": true,
            "scrollCollapse": true,
            "paging": false,
            "searching": false,
            "info": false,
            "bAutoWidth": true,
            "order": [],
            "fnAdjustColumnSizing": true,
            "fnInitComplete": adjust_db_column_preferences()
        });

    }

    function initialize_metrics_table(table_id, prefix) {

        $("#" + table_id).DataTable({
            "scrollY": 200,  // 200
            "scrollX": true,
            "scrollCollapse": true,
            "paging": false,
            "searching": false,
            "info": false,
            "bAutoWidth": true,
            "bSort": false,
            "order": [],
            "fnInitComplete": adjust_tables_after_loading(table_id, prefix),
            "fnAdjustColumnSizing": false
        });
    }

    function adjust_tables_after_loading(table_id, prefix) {
        add_ids_to_metrics_table(table_id, prefix);
    }

    function adjust_db_column_preferences() {

        // hide_user_column_preferences_by_id("product_quality_table", "pq");

        //hide_user_column_preferences_by_column_name("product_quality_table", "pq");
        hide_user_column_preferences_by_column_name("quality_assurance_table", "qa");
        hide_user_column_preferences_by_column_name("quality_innovation_table", "qi");
        hide_user_column_preferences_by_column_name("requirements_engineering_table", "re");
        hide_user_column_preferences_by_column_name("test_engineering_table", "te");
        hide_user_column_preferences_by_column_name("test_lab_table", "tl");
    }

    function build_column_names_lists() {

        // list of the default column names for each table

        $("#product_quality_table tr th").each(function () {
            var header_text = $(this).text();
            home_pq_all_column_names_list.push(header_text);
        });

        $("#quality_assurance_table tr th").each(function () {
            var header_text = $(this).text();
            home_qa_all_column_names_list.push(header_text);
        });

        $("#quality_innovation_table tr th").each(function () {
            var header_text = $(this).text();
            home_qi_all_column_names_list.push(header_text);
        });

        $("#requirements_engineering_table tr th").each(function () {
            var header_text = $(this).text();
            home_re_all_column_names_list.push(header_text);
        });

        $("#test_engineering_table tr th").each(function () {
            var header_text = $(this).text();
            home_te_all_column_names_list.push(header_text);
        });

        $("#test_lab_table tr th").each(function () {
            var header_text = $(this).text();
            home_tl_all_column_names_list.push(header_text);
        });

        home_pq_number_of_columns = home_pq_all_column_names_list.length;
        home_qa_number_of_columns = home_qa_all_column_names_list.length;
        home_qi_number_of_columns = home_qi_all_column_names_list.length;
        home_re_number_of_columns = home_re_all_column_names_list.length;
        home_te_number_of_columns = home_te_all_column_names_list.length;
        home_tl_number_of_columns = home_tl_all_column_names_list.length;
    }

    function add_ids_to_metrics_table(table_id, prefix) {

        var row_count = 0;

        $('#' + table_id + ' tbody tr').each(function () {
            var column_count = 1;
            $('td', this).each(function () {
                var temp_id = "" + prefix + "_" + row_count + "_" + column_count;
                $(this).attr("id", temp_id);
                column_count++;
            });
            row_count++;
        });
    }

    // start of dnd section
    function allow_drop_home(event) {
        event.preventDefault();
    }

    function drag_home(event) {
        var target = event.target || event.srcElement;
        home_dnd_id = target.id;
        event.dataTransfer.setData("text", event.target.id);
    }

    function drop_home(event) {
        event.preventDefault();
        var temp_array = home_dnd_id.split("_");
        var temp_column = temp_array[2];
        add_chart_to_table_home(event, temp_column);
    }

    // end of dnd section

    // start of chart section
    function add_chart_to_table_home(event, dnd_drag_column_number) {

        event.preventDefault();

        home_next_chart_id++;
        var chart_count = home_next_chart_id;

        var chart_object = new Object();
        chart_object.table_dnd_id = home_dnd_id;
        chart_object.chart_count = chart_count;
        chart_object.dnd_drag_column_number = dnd_drag_column_number;
        chart_object.chart_type = "bar";
        chart_object.x_axis = home_primary_date_time_column;

        chart_object.dnd_table_name_id = get_drag_table_source_id(home_dnd_id);
        chart_object.y_column_name = get_y_column_name(home_dnd_id, dnd_drag_column_number);

        // alert("662  " + chart_object.y_column_name);

        chart_object.chart_title = get_drag_table_friendly_name(home_dnd_id) + " --- " + chart_object.y_column_name;

        home_dnd_charts_list.push(chart_object);

        $.ajax({
            url: "{% url 'users:add_home_chart' %}",
            dataType: 'html',
            data: '',
            type: 'POST',
            success: function () {
                var chart_html = get_chart_html_home(chart_count);
                $("#home_chart_row").append(chart_html);
                draw_d3_bar_chart_home(chart_object);

                $("input:radio[name='chart_group_" + chart_count + "'][value='bar']").prop('checked', true);
                // disable the x-axis dnd table cell
                // $("#pq_xy_dnd_row_" + chart_count).hide();  // do not allow dnd to change the x or y axis
                // alert("Success");
                $("#home_chart_title_" + chart_count).html(chart_object.chart_title);
            },
            error: function () {
                alert("Error Adding Chart");
            }
        });

    }

    function get_chart_html_home(chart_count) {

        var output = "<td id='home_chart_td_" + chart_count + "' class='chart_td'>";

        output = output + "<table class='chart_dnd_table'><tbody>";

        // table name
        // output = output + "<tr><td colspan='2' id='home_title_" + chart_count + "' class='td_title'>" + "</td></tr>";

        output = output + "<tr><td id='home_chart_title_" + chart_count + "' class='td_title'></td></tr>";

        // row with dnd area for the x and y axis
        //output = output + "<tr id='home_xy_dnd_row_" + chart_count + "'>";
        //output = output + "<td id='home_x_dnd_" + chart_count + "' class='td_xy_dnd' ondrop='pq_td_x_drop(event)' ondragover='pq_allow_x_drop(event)'>X-Axis</td>";
        //output = output + "<td id='home_y_dnd_" + chart_count + "' class='td_xy_dnd' ondrop='pq_td_y_drop(event)' ondragover='pq_allow_y_drop(event)'>Y-Axis</td>";
        //output = output + "</tr>";

        output = output + "<tr><td class='chart_td'>";
        output = output + "<div id='" + home_chart_svg_prefix + chart_count + "' class='chart_svg_div'>chart" + chart_count + "</div>";
        output = output + "</td></tr>";

        output = output + "<tr><td colspan='2'>";
        output = output + "<div id='home_radio_div_" + chart_count + "' class='chart_radio_div'>";

        output = output + "<table class='radio_table'><tbody><tr>";
        output = output + "<td><input type='radio' id='home_bar_" + chart_count + "' name='chart_group_" + chart_count + "' value='bar' onchange='process_radio_chart_selection_home(event)'>Bar Chart</td>";
        output = output + "<td><input type='radio' id='home_line_" + chart_count + "' name='chart_group_" + chart_count + "' value='line' onchange='process_radio_chart_selection_home(event)'>Line Chart</td>";
        output = output + "<td><input type='radio' id='home_pie_" + chart_count + "' name='chart_group_" + chart_count + "' value='pie' onchange='process_radio_chart_selection_home(event)'>Pie Chart</td>";

        output = output + "<td class='td_delete_btn'><input type='button' id='home_delete_chart_button_" + chart_count + "' value='Delete Chart' onclick='on_click_delete_chart_home(event)'></td>";
        output = output + "</table></div>";
        output = output + "</td></tr>";

        output = output + "</tbody></table></td>";

        return output;
    }

    function process_radio_chart_selection_home(event) {

        var target = event.target || event.srcElement;
        var target_id = target.id;

        var details_list = target_id.split("_");
        var chart_type = details_list[1];
        var chart_count = details_list[2];

        var chart_object = get_chart_object_from_list_home(chart_count);

        if (chart_type === 'bar') {
            chart_object.chart_type = "bar";
            draw_d3_bar_chart_home(chart_object);
            // $("#home_xy_dnd_row_" + chart_count).hide();
        } else if (chart_type === 'line') {
            chart_object.chart_type = "line";
            draw_d3_line_chart_home(chart_object);
            // $("#pq_xy_dnd_row_" + chart_count).hide();
        } else if (chart_type === 'pie') {
            chart_object.chart_type = "pie";
            draw_d3_pie_chart_home(chart_object);
            // $("#pq_xy_dnd_row_" + chart_count).hide();
        }
    }

    function draw_d3_pie_chart_home(chart_object) {

        var svg_id = chart_object.chart_count;

        $("#home_chart_svg_" + svg_id).html("");

        // the user can drag form any of the smaller tables so I need the drag source
        var table_id = chart_object.dnd_table_name_id;

        var chart_width = 400;
        var chart_height = 400;
        var radius = chart_height / 2;

        var color = d3.scale.category20c();

        var weekly_data = get_column_data(0, table_id);

        var parsed_date_list = [];

        for (var index01 = 0; index01 < weekly_data.length; index01++) {
            parsed_date_list.push(getParsedMonthDayYear(weekly_data[index01]));  // string  Oct 5, 2015, 4:36p.m.
        }

        var data = [];

        var chart_data = get_column_data(chart_object.dnd_drag_column_number - 1, table_id);

        for (var index = 0; index < chart_data.length; index++) {
            var temp_value = chart_data[index];
            // data.push({"label": "Week " + (index + 1), "value": temp_value});
            data.push({"label": parsed_date_list[index], "value": chart_data[index]});
        }

        var vis = d3.select('#home_chart_svg_' + svg_id).append("svg:svg").data([data]).attr("width", chart_width).attr("height", chart_height).append("svg:g").attr("transform", "translate(" + radius + "," + radius + ")");
        var pie = d3.layout.pie().value(function (d) {
            return d.value;
        });

        pie.sort(null);

        // declare an arc generator function
        var arc = d3.svg.arc().outerRadius(radius);

        // select paths, use arc generator to draw
        var arcs = vis.selectAll("g.slice").data(pie).enter().append("svg:g").attr("class", "slice");
        arcs.append("svg:path")
                .attr("fill", function (d, i) {
                    return color(i);
                })
                .attr("d", function (d) {
                    return arc(d);
                });

        // add the text
        arcs.append("svg:text").attr("transform", function (d) {
            d.innerRadius = 0;
            d.outerRadius = radius;
            return "translate(" + arc.centroid(d) + ")";
        }).attr("text-anchor", "middle").text(function (d, i) {
                    return data[i].label;
                }
        );

    }

    function draw_d3_bar_chart_home(chart_object) {

        var svg_id = chart_object.chart_count;

        $("#home_chart_svg_" + svg_id).html("");

        // the user can drag form any of the smaller tables so I need the drag source
        var table_id = chart_object.dnd_table_name_id;

        var chart_width = 400;
        var chart_height = 400;

        var margin = {top: 20, right: 20, bottom: 30, left: 40};
        var width = chart_width - margin.left - margin.right;
        var height = chart_height - margin.top - margin.bottom;

        var x = d3.scale.ordinal().rangeRoundBands([0, width], .1);

        var y = d3.scale.linear().range([height, 0]);

        var xAxis = d3.svg.axis().scale(x).orient("bottom");

        var yAxis = d3.svg.axis().scale(y).orient("left");  //.ticks(10, "%");

        var y_column = chart_object.dnd_drag_column_number;

        var y_data = get_column_data(y_column - 1, table_id);

        // parse the date information for the x-axis
        var x_data = get_column_data(0, table_id);
        var x_date_time = [];

        for (var index01 = 0; index01 < x_data.length; index01++) {
            x_date_time.push(getParsedDate(x_data[index01]));  // string  Oct 5, 2015, 4:36p.m.
        }

        var data = [];
        for (var index02 = 0; index02 < y_data.length; index02++) {
            data.push({'x': x_date_time[index02], 'y': parseFloat(y_data[index02])});
        }

        //for (var index03 = 0; index03 < data.length; index03++) {
        //    displayObject(data[index03]);
        //}

        // if the y value is zero, display a thin line instead of empty space
        var ymax = d3.max(data, function (d) {
            return d.y;
        });

        var min_unit = 0.0;  // ymax / chart_height;

        var xScale = d3.scale.ordinal()
                .domain(d3.range(data.length))
                .rangeRoundBands([0, chart_width], 0.05);

        var yScale = d3.scale.linear()
                .domain([0, d3.max(data) + 1.0])
                .range([0, chart_height]);

        x.domain(data.map(function (d) {
            return d.x;
        }));

        y.domain([0, d3.max(data, function (d) {
            return d.y;
        })]);

        var svg = d3.select("#home_chart_svg_" + svg_id).append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        svg.append("g")
                .attr("class", "x axis")
                .attr("transform", "translate(0," + height + ")")
                .call(xAxis)
                .attr("font-family", "sans-serif")
                .attr("font-size", "10px");

        svg.append("g")
                .attr("class", "y axis")
                .call(yAxis)
                .append("text")
                .attr("transform", "rotate(-90)");

        for (var index = 0; index < data.length; index++) {

            svg.selectAll("rect")
                    .data(data)
                    .enter()
                    .append("rect")
                    .attr("class", "bar")
                    .attr("x", function (d) {
                        return x(d.x);
                    })
                    .attr("width", x.rangeBand())
                    .attr("y", function (d) {
                        return y(d.y);
                    })
                    .attr("height", function (d) {
                        var temp_height = parseFloat(height - y(d.y));
                        if (temp_height < min_unit) {
                            temp_height = min_unit;
                        }
                        return temp_height;
                    })
                    .attr("fill", "blue")
                    .on("mouseover", function (d) {

                        // get this bar's x/y values, then augment for the tooltip
                        var xPosition = parseFloat(d3.select(this).attr("x")) + (xScale.rangeBand() / 2) - 4;
                        var yPosition = parseFloat(d3.select(this).attr("y")) + 50;

                        // create the tooltip label
                        svg.append("text")
                                .attr("id", "tooltip")
                                .attr("x", xPosition)
                                .attr("y", yPosition)
                                .attr("text-anchor", "middle")
                                .attr("font-family", "sans-serif")
                                .attr("font-size", "11px")
                                .attr("font-weight", "bold")
                                .attr("fill", "white")
                                .text(d.y);
                    })
                    .on("mouseout", function () {  // remove the tooltip
                        d3.select("#tooltip").remove();
                    });

        }

    }

    function draw_d3_line_chart_home(chart_object) {

        // displayObject(chart_object, "1234 home bar chart");  // TODO working here

        var svg_id = chart_object.chart_count;

        $("#home_chart_svg_" + svg_id).html("");

        // the user can drag form any of the smaller tables so I need the drag source
        var table_id = chart_object.dnd_table_name_id;

        var data = [];

        // each of the data objects is attached to a date
        // var x_axis = chart_object.x_axis;  // date_time_column

        var x_data = get_line_chart_dates_home(0, table_id);
        // alert("1249  " + x_data);
        //var x_data = get_column_data(0, "date_table");
        //var x_date_time = [];

        //for (var index01 = 0; index01 < x_data.length; index01++) {
        //    x_date_time.push(getParsedDate(x_data[index01]));  // string  Oct 5, 2015, 4:36p.m.
        //}
        // alert("582  " + x_data);
        var y_data = get_column_data(chart_object.dnd_drag_column_number - 1, table_id);

        var y_column_name = "";  // get_y_column_name(chart_object.table_dnd_id);\\"";
        // getColumnNameFromColumnDetailsList(chart_object.dnd_drag_column_number, product_quality_column_details_list);

        for (var index = 0; index < y_data.length; index++) {
            data.push({'x': x_data[index], 'y': y_data[index]});
        }

        var chart_width = 400, chart_height = 400;  // 350;
        var margin = {
            top: 20,
            right: 50,
            bottom: 40,
            left: 30
        };

        // these are graph size settings
        var width = chart_width - margin.left - margin.right;
        var height = chart_height - margin.top - margin.bottom;

        var x_min = x_data[0];
        var x_max = x_data[x_data.length - 1];

        var minObjectValue = parseFloat(d3.min(data, function (d) {
            return d.y;
        }));
        var maxObjectValue = parseFloat(d3.max(data, function (d) {
            return d.y;
        }));

        // create the graph object
        var vis = d3.select("#home_chart_svg_" + svg_id).append("svg")
                .data(data)
                .attr("class", "metrics-container")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        var y = d3.scale.linear().domain([minObjectValue - (.1 * minObjectValue), maxObjectValue + (.1 * maxObjectValue)]).range([height, 0]);
        var x = d3.time.scale().domain([x_min, x_max]).range([0, width]);

        var yAxis = d3.svg.axis()
                .scale(y)
                .orient("left")
                .ticks(5);

        var xAxis = d3.svg.axis()
                .scale(x)
                .orient("bottom")
                .ticks(x_data.length)
                .tickFormat(d3.time.format("%m-%d"));

        vis.append("g")
                .attr("class", "axis")
                .attr("font-family", "sans-serif")
                .attr("font-size", "12px")
                .call(yAxis);

        vis.append("g")
                .attr("class", "axis")
                .attr("transform", "translate(0," + height + ")")
                .attr("font-family", "sans-serif")
                .attr("font-size", "12px")
                .call(xAxis);

        // add the axes labels
        vis.append("text")
                .attr("class", "axis-label")
                .attr("text-anchor", "end")
                .attr("x", width / 2)
                .attr("y", height + 40);
        //.text('Date');

        vis.append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 0 - margin.left)
                .attr("x", 0 - (height / 2))
                .attr("dy", "1.5em")
                .style("text-anchor", "start")
                .text(y_column_name);

        var line = d3.svg.line()
                .x(function (d) {
                    return x(d["x"]);
                })
                .y(function (d) {
                    return y(d["y"]);
                });

        vis.append("svg:path")
                .attr("d", line(data))
                .style("stroke", function () {
                    return "#000000";
                })
                .style("fill", "none")
                .style("stroke-width", "2.5");

        var dataCirclesGroup = vis.append('svg:g');

        var circles = dataCirclesGroup.selectAll('.data-point').data(data);

        circles.enter()
                .append('svg:circle')
                .attr('class', 'dot')
                .attr('fill', function () {
                    return "red";
                })
                .attr('cx', function (d) {
                    return x(d["x"]);
                })
                .attr('cy', function (d) {
                    return y(d["y"]);
                })
                .attr('r', function () {
                    return 3;
                })
                .on("mouseover", function (d) {
                    d3.select(this)
                            .attr("r", 8)
                            .attr("class", "dot-selected")
                            .transition()
                            .duration(750);
                })
                .on("mouseout", function (d) {
                    d3.select(this)
                            .attr("r", 3)
                            .attr("class", "dot")
                            .transition()
                            .duration(750);
                });

    }


    function get_chart_object_from_list_home(temp_number) {

        var chart_object = null;

        for (var index = 0; index < home_dnd_charts_list.length; index++) {
            var temp_object = home_dnd_charts_list[index];
            if (temp_object.chart_count == temp_number) {
                chart_object = temp_object;
                break;
            }
        }
        return chart_object;
    }

    function remove_chart_from_list_home(temp_number) {

        for (var index = 0; index < home_dnd_charts_list.length; index++) {
            var temp_object = home_dnd_charts_list[index];
            if (temp_object.chart_count == temp_number) {
                home_dnd_charts_list.splice(index, 1);
                break;
            }
        }
    }

    function on_click_delete_chart_home(event) {

        var target = event.target || event.srcElement;
        var id = target.id;

        var final_id = id.substring("home_delete_chart_button_".length);

        $.ajax({
            url: "{% url 'users:delete_home_chart' %}",
            dataType: 'html',
            data: '',
            type: 'POST',
            success: function (data) {
                $("#home_chart_td_" + final_id).remove();
                remove_chart_from_list_home(final_id);
            },
            error: function (data, status, error) {
                alert("Error Deleting Chart " + status);
            }
        });
    }

    function get_drag_table_source_id(temp_table_dnd_id) {

        var temp_array = temp_table_dnd_id.split("_");
        var prefix = temp_array[0];

        var table_id = "";

        if (prefix === "pq") {
            table_id = "product_quality_table";
        } else if (prefix === "qa") {
            table_id = "quality_assurance_table";
        } else if (prefix === "qi") {
            table_id = "quality_innovation_table";
        } else if (prefix === "re") {
            table_id = "requirements_engineering_table";
        } else if (prefix === "te") {
            table_id = "test_engineering_table";
        } else if (prefix === "tl") {
            table_id = "test_lab_table";
        }
        return table_id;
    }

    function get_drag_table_friendly_name(temp_table_dnd_id) {

        var temp_array = temp_table_dnd_id.split("_");
        var prefix = temp_array[0];

        var table_name = "";

        if (prefix === "pq") {
            table_name = "Product Quality";
        } else if (prefix === "qa") {
            table_name = "Quality Assurance";
        } else if (prefix === "qi") {
            table_name = "Quality Innovation";
        } else if (prefix === "re") {
            table_name = "Requirements Engineering";
        } else if (prefix === "te") {
            table_name = "Test Engineering";
        } else if (prefix === "tl") {
            table_name = "Test Lab";
        }
        return table_name;
    }

    function get_y_column_name(temp_dnd_id, temp_dnd_drag_column_number) {

        var temp_array = temp_dnd_id.split("_");
        var prefix = temp_array[0];

        // header id will look like 'pq_th_r1__column
        var temp_id = prefix + "_th_r1_" + (temp_dnd_drag_column_number - 1);

        var header_text = $("#" + temp_id).text();

        return header_text;
    }

    function get_line_chart_dates_home(date_time_column_number, temp_table_id) {  // working here

        var date_time_data = [];

        $('#' + temp_table_id + ' tbody tr').each(function () {
            var date_time_value = $(this).children("td:eq(" + date_time_column_number + ")").text();
            var temp_date = new Date.parse(date_time_value);
            date_time_data.push(temp_date);
        });

        return date_time_data;
    }

    //function get_line_chart_dates_home(table_id) {
    //    return get_date_time_data_home(0, table_id);
    //}

    // show or hide the tables or columns
    function on_change_show_hide_metrics_table(event) {

        var target = event.target || event.srcElement;
        var target_id = target.id;  // column_XX

        var temp_array = target_id.split("_");
        var prefix = temp_array[0];

        // if the user is hiding a table, add all the column indexes to the hide column list and update the database

        if (prefix === "pq") {

            var checked = $('#pq_show_hide_checkbox').prop('checked');

            if (checked) {

                $("#td_product_quality_table").show();
                $("#pq_show_hide_columns_button").prop("disabled", false);
                home_pq_hide_column_list = [];
                $("#pq_show_hide_dialog_button").prop("disabled",false).css('opacity', 1.0);

            } else {

                $("#td_product_quality_table").hide();
                add_all_columns_to_hide_list(home_pq_hide_column_list, home_pq_number_of_columns);
                update_hidden_columns_list_db_by_column_name("product_quality_table", home_pq_hide_column_list);
                $("#pq_show_hide_dialog_button").prop("disabled",true).css('opacity', 0.5);
            }

        } else if (prefix === "qa") {

            var checked = $('#qa_show_hide_checkbox').prop('checked');

            if (checked) {

                $("#td_quality_assurance_table").show();
                $("#qa_show_hide_columns_button").prop("disabled", false);
                home_qa_hide_column_list = [];
                $("#qa_show_hide_dialog_button").prop("disabled",false).css('opacity', 1.0);

            } else {

                $("#td_quality_assurance_table").hide();
                add_all_columns_to_hide_list(home_qa_hide_column_list, home_qa_number_of_columns);
                update_hidden_columns_list_db_by_column_name("quality_assurance_table", home_qa_hide_column_list);
                $("#qa_show_hide_dialog_button").prop("disabled",true).css('opacity', 0.5);
            }

        } else if (prefix === "qi") {

            var checked = $('#qi_show_hide_checkbox').prop('checked');

            if (checked) {

                $("#td_quality_innovation_table").show();
                $("#qi_show_hide_columns_button").prop("disabled", false);
                home_qi_hide_column_list = [];
                $("#qi_show_hide_dialog_button").prop("disabled",false).css('opacity', 1.0);

            } else {

                $("#td_quality_innovation_table").hide();
                add_all_columns_to_hide_list(home_qi_hide_column_list, home_qi_number_of_columns);
                update_hidden_columns_list_db_by_column_name("quality_innovation_table", home_qi_hide_column_list);
                $("#qi_show_hide_dialog_button").prop("disabled",true).css('opacity', 0.5);

            }

        } else if (prefix === "re") {

            var checked = $('#re_show_hide_checkbox').prop('checked');

            if (checked) {

                $("#td_requirements_engineering_table").show();
                $("#re_show_hide_columns_button").prop("disabled", false);
                home_re_hide_column_list = [];
                $("#re_show_hide_dialog_button").prop("disabled",false).css('opacity', 1.0);

            } else {

                $("#td_requirements_engineering_table").hide();
                add_all_columns_to_hide_list(home_re_hide_column_list, home_re_number_of_columns);
                update_hidden_columns_list_db_by_column_name("requirements_engineering_table", home_re_hide_column_list);
                $("#re_show_hide_dialog_button").prop("disabled",true).css('opacity', 0.5);

            }

        } else if (prefix === "te") {

            var checked = $('#te_show_hide_checkbox').prop('checked');

            if (checked) {

                $("#td_test_engineering_table").show();
                $("#te_show_hide_columns_button").prop("disabled", false);
                home_te_hide_column_list = [];
                $("#te_show_hide_dialog_button").prop("disabled",false).css('opacity', 1.0);

            } else {

                $("#td_test_engineering_table").hide();
                add_all_columns_to_hide_list(home_te_hide_column_list, home_te_number_of_columns);
                update_hidden_columns_list_db_by_column_name("test_engineering_table", home_te_hide_column_list);
                $("#te_show_hide_dialog_button").prop("disabled",true).css('opacity', 0.5);

            }

        } else if (prefix === "tl") {

            var checked = $('#tl_show_hide_checkbox').prop('checked');

            if (checked) {

                $("#td_test_lab_table").show();
                $("#tl_show_hide_columns_button").prop("disabled", false);
                home_tl_hide_column_list = [];
                $("#tl_show_hide_dialog_button").prop("disabled",false).css('opacity', 1.0);

            } else {

                $("#td_test_lab_table").hide();
                add_all_columns_to_hide_list(home_tl_hide_column_list, home_tl_number_of_columns);
                update_hidden_columns_list_db_by_column_name("test_lab_table", home_tl_hide_column_list);
                $("#tl_show_hide_dialog_button").prop("disabled",true).css('opacity', 0.5);

            }

        }

        show_hide_date_table();

    }

    function on_click_show_hide_columns_dialog(event) {

        var target = event.target || event.srcElement;
        var target_id = target.id;

        var temp_array = target_id.split("_");  // e.g.  pq_show_hide_dialog_button"

        var prefix = temp_array[0];

        var table_id = "";
        var all_column_names_list = [];
        var hide_column_list = [];
        // var table_visible = true;
        var table_title = "";

        if (prefix === "pq") {

            table_id = "product_quality_table";
            all_column_names_list = home_pq_all_column_names_list;
            hide_column_list = home_pq_hide_column_list;
            // table_visible = $('#product_quality_table').is(':visible');
            table_title = "Product Quality Columns";

        } else if (prefix == "qa") {

            table_id = "quality_assurance_table";
            all_column_names_list = home_qa_all_column_names_list;
            hide_column_list = home_qa_hide_column_list;
            // table_visible = $('#quality_assurance_table').is(':visible');
            table_title = "Quality Assurance Columns";

        } else if (prefix == "qi") {

            table_id = "quality_innovation_table";
            all_column_names_list = home_qi_all_column_names_list;
            hide_column_list = home_qi_hide_column_list;
            // table_visible = $('#quality_innovation_table').is(':visible');
            table_title = "Quality Innovation Columns";

        } else if (prefix == "re") {

            table_id = "requirements_engineering_table";
            all_column_names_list = home_re_all_column_names_list;
            hide_column_list = home_re_hide_column_list;
            // table_visible = $('#requirements_engineering_table').is(':visible');
            table_title = "Requirements Engineering Columns";

        } else if (prefix == "te") {

            table_id = "test_engineering_table";
            all_column_names_list = home_te_all_column_names_list;
            hide_column_list = home_te_hide_column_list;
            // table_visible = $('#test_engineering_table').is(':visible');
            table_title = "Test Engineering Columns";

        } else if (prefix == "tl") {

            table_id = "test_lab_table";
            all_column_names_list = home_tl_all_column_names_list;
            hide_column_list = home_tl_hide_column_list;
            // table_visible = $('#test_lab_table').is(':visible');
            table_title = "Test Lab Columns";
        }

        selected_show_hide_table = table_id;

        var output = "";
        var header_count = 1;

        for (var index = 0; index < all_column_names_list.length; index++) {

            var checkbox_id = "column_" + header_count.toString();
            var checkbox_str = "";

            if (index == 0) {
                checkbox_str = "<input type='checkbox' id='" + checkbox_id + "'" + " checked disabled />&nbsp;&nbsp;" + all_column_names_list[index];
            } else {
                checkbox_str = "<input type='checkbox' id='" + checkbox_id + "' + onchange='checkbox_change(event)' />&nbsp;&nbsp;" + all_column_names_list[index];
            }

            output = output + checkbox_str + "<br>";
            header_count++;
        }

        $("#dialog").html(output);
        $("#dialog").dialog({
            title: table_title,  // "Table Columns",
            resizable: false,
            height: 400,
            width: 400,
            modal: false,
            buttons: {
                Close: function () {
                    $(this).dialog("close");
                }
            }
        });

        var current_column_names_list = [];

        var column_count = 0;

        $('#' + prefix + '_th_r1 th').each(function () {

            var name = $(this).text().trim();

            if ($.inArray(name, current_column_names_list) == -1) {
                current_column_names_list.push(name);
            }

            column_count++;
        });

        for (var index = 0; index < all_column_names_list.length; index++) {

            var in_current = $.inArray(all_column_names_list[index].trim(), current_column_names_list);
            // var in_hide_list = $.inArray(index, hide_column_list);

            var column_id = "column_" + Number(index + 1);

            //if (table_visible) {

                if (in_current > -1) {
                    $("#" + column_id).prop('checked', true);
                } else {
                    $("#" + column_id).prop('checked', false);

                    if ($.inArray(Number(index + 1), hide_column_list) == -1) {
                        hide_column_list.push(Number(index + 1));
                    }
                }

            //} else {
                // all the checkboxes should be unchecked
            //    $("#" + column_id).prop('checked', false);
            //    hide_column_list.length = 0;
            //}

        }

    }

    function checkbox_change(event) {

        var target = event.target || event.srcElement;
        var target_id = target.id;  // column_XX

        var index = target_id.indexOf("_");
        var checkbox_number = Number(target_id.substring(index + 1)) - 1;

        var checked = $("#" + target_id).prop('checked');

        var hide_column_list = [];
        var max_columns = 0;

        if (selected_show_hide_table === "product_quality_table") {

            hide_column_list = home_pq_hide_column_list;
            max_columns = home_pq_number_of_columns;

        } else if (selected_show_hide_table == "quality_assurance_table") {

            hide_column_list = home_qa_hide_column_list;
            max_columns = home_qa_number_of_columns;

        } else if (selected_show_hide_table == "quality_innovation_table") {

            hide_column_list = home_qi_hide_column_list;
            max_columns = home_qi_number_of_columns;

        } else if (selected_show_hide_table == "requirements_engineering_table") {

            hide_column_list = home_re_hide_column_list;
            max_columns = home_re_number_of_columns;

        } else if (selected_show_hide_table == "test_engineering_table") {

            hide_column_list = home_te_hide_column_list;
            max_columns = home_te_number_of_columns;

        } else if (selected_show_hide_table == "test_lab_table") {

            hide_column_list = home_tl_hide_column_list;
            max_columns = home_tl_number_of_columns;

        }

        if (checked) {

            // if the user has checked one of the checkboxes, make sure the checkbox to show/hide the table is correct
            remove_from_hide_list(hide_column_list, checkbox_number);

            show_hide_column(selected_show_hide_table, checkbox_number, "show", false, true);

        } else {

            if ($.inArray(checkbox_number, hide_column_list) == -1) {
                hide_column_list.push(checkbox_number);
            }

            var force_table_hide = false;

            if (hide_column_list.length == max_columns) {
                force_table_hide = true;
            }

            show_hide_column(selected_show_hide_table, checkbox_number, "hide", force_table_hide, false);
        }

        // update_hidden_columns_list_db_by_column_index(selected_show_hide_table, hide_column_list);
        update_hidden_columns_list_db_by_column_name(selected_show_hide_table, hide_column_list);
    }

    function remove_from_hide_list(temp_list, temp_number) {

        for (var index = 0; index < temp_list.length; index++) {

            if (Number(temp_list[index] == Number(temp_number))) {
                temp_list.splice(index, 1);
                break;
            }
        }

    }

    function show_hide_column(temp_table_id, column_number, show_hide, force_table_hide, force_table_show) {

        // console.log("show_hide_column " + column_number + "  " + force_table_hide + "  " + force_table_show);

        var oTable = $('#' + temp_table_id).dataTable();

        var prefix = "";
        var max_columns = 0;

        if (temp_table_id === "product_quality_table") {

            prefix = "pq";
            max_columns = home_pq_number_of_columns;

        } else if (temp_table_id === "quality_assurance_table") {

            prefix = "qa";
            max_columns = home_qa_number_of_columns;

        } else if (temp_table_id === "quality_innovation_table") {

            prefix = "qi";
            max_columns = home_qi_number_of_columns;

        } else if (temp_table_id === "requirements_engineering_table") {

            prefix = "re";
            max_columns = home_re_number_of_columns;

        } else if (temp_table_id === "test_engineering_table") {

            prefix = "te";
            max_columns = home_te_number_of_columns;

        } else if (temp_table_id === "test_lab_table") {

            prefix = "tl";
            max_columns = home_tl_number_of_columns;

        }

        if (show_hide === "hide") {

            if (force_table_hide) {

                // all of the columns have been hidden so uncheck the checkbox for the table
                if (prefix === "pq") {
                    $("#pq_show_hide_checkbox").prop('checked', false);
                } else if (prefix === "qa") {
                    $("#qa_show_hide_checkbox").prop('checked', false);
                } else if (prefix === "qi") {
                    $("#qi_show_hide_checkbox").prop('checked', false);
                } else if (prefix === "re") {
                    $("#re_show_hide_checkbox").prop('checked', false);
                } else if (prefix === "te") {
                    $("#te_show_hide_checkbox").prop('checked', false);
                } else if (prefix === "tl") {
                    $("#tl_show_hide_checkbox").prop('checked', false);
                }

                // hide the header for the column
                $('#' + prefix + "_th_r1_" + column_number).hide();

                // the fnSetColumnVis call does not remove the whole table if the last column is removed
                $('#td_' + temp_table_id).hide();

                $('#' + prefix + '_th_r1').hide();  // eg.  pq_th_r1

                $('#' + prefix + '_legend').hide();

            }

            oTable.fnSetColumnVis(Number(column_number), false, false);

        } else if (show_hide === "show") {  // working here

            // alert("1573  " + force_table_show);

            if (force_table_show) {

                if (prefix === "pq") {
                    $("#pq_show_hide_checkbox").prop('checked', true);
                } else if (prefix === "qa") {
                    $("#qa_show_hide_checkbox").prop('checked', true);
                } else if (prefix === "qi") {
                    $("#qi_show_hide_checkbox").prop('checked', true);
                } else if (prefix === "re") {
                    $("#re_show_hide_checkbox").prop('checked', true);
                } else if (prefix === "te") {
                    $("#te_show_hide_checkbox").prop('checked', true);
                } else if (prefix === "tl") {
                    $("#tl_show_hide_checkbox").prop('checked', true);
                }

                // show the header for the column
                $('#' + prefix + "_th_r1_" + column_number).show();

                $('#td_' + temp_table_id).show();

                $('#' + prefix + '_th_r1').show();  // eg.  pq_th_r1

                $('#' + prefix + '_legend').show();

                // columns in the table body are fine, missing a table header
                oTable.fnSetColumnVis(Number(column_number), true, true);

            }

            // columns in the table body are fine, missing a table header
            for (var index = 0; index < max_columns; index++) {
                $('#' + prefix + "_th_r1_" + (index + 1)).show();
            }

            oTable.fnSetColumnVis(Number(column_number), true, false);

        }

        oTable.fnDraw();

    }

    function add_all_columns_to_hide_list(temp_hide_column_list, temp_number_of_columns) {

        temp_hide_column_list.length = 0;

        for (var index = 0; index < temp_number_of_columns; index++) {
            temp_hide_column_list.push(index);
        }

    }

    // saves the hidden columns by column index
    function update_hidden_columns_list_db_by_column_index(temp_table_id, temp_hide_column_list) {

        var column_str = temp_hide_column_list.toString();

        $.ajax({
            url: "{% url 'users:update_user_chart_preferences' %}",
            dataType: 'text',
            data: {
                'table_name': temp_table_id,
                'column_list': column_str
            },
            type: 'POST',
            success: function () {
                // alert("Success");
            },
            error: function () {
                alert("Error Adding Chart");
            }
        });

    }

    function update_hidden_columns_list_db_by_column_name(temp_table_id, temp_id_hide_column_list) {

        var temp_all_column_names_list;

        if (temp_table_id === "product_quality_table") {
            temp_all_column_names_list = home_pq_all_column_names_list;
        } else if (temp_table_id === "quality_assurance_table") {
            temp_all_column_names_list = home_qa_all_column_names_list;
        } else if (temp_table_id === "quality_innovation_table") {
            temp_all_column_names_list = home_qi_all_column_names_list;
        } else if (temp_table_id === "requirements_engineering_table") {
            temp_all_column_names_list = home_re_all_column_names_list;
        } else if (temp_table_id === "test_engineering_table") {
            temp_all_column_names_list = home_te_all_column_names_list;
        } else if (temp_table_id === "test_lab_table") {
            temp_all_column_names_list = home_tl_all_column_names_list;
        }

        var temp_hidden_names_list = [];

        for (var index = 0; index < temp_id_hide_column_list.length; index++) {

            var temp_value = temp_id_hide_column_list[index];
            var column_name = temp_all_column_names_list[temp_value];

            if ($.inArray(column_name, temp_hidden_names_list) == -1) {
                temp_hidden_names_list.push(column_name);
            }
        }

        var column_str = temp_hidden_names_list.toString();

        $.ajax({
            url: "{% url 'users:update_user_chart_preferences' %}",
            dataType: 'text',
            data: {
                'table_name': temp_table_id,
                'column_list': column_str
            },
            type: 'POST',
            success: function () {
                // alert("Success");
            },
            error: function () {
                // alert("Error Updating Chart Preferences");
            }
        });

    }

    // hide columns by the id
    function hide_user_column_preferences_by_id(temp_table_id, prefix) {

        var hide_columns_json;
        // var hide_column_list;

        var max_columns = 0;
        // var temp_button;

        if (prefix === "pq") {

            // hide_column_list = home_pq_hide_column_list;
            hide_columns_json = home_pq_hide_columns_json;
            max_columns = home_pq_number_of_columns;
            // temp_button = "pq_show_hide_columns_button";

        } else if (prefix === "qa") {

            // hide_column_list = home_qa_hide_column_list;
            hide_columns_json = home_qa_hide_columns_json;
            max_columns = home_qa_number_of_columns;
            // temp_button = "qa_show_hide_columns_button";

        } else if (prefix === "qi") {

            // hide_column_list = home_qi_hide_column_list;
            hide_columns_json = home_qi_hide_columns_json;
            max_columns = home_qi_number_of_columns;
            // temp_button = "qi_show_hide_columns_button";

        } else if (prefix === "re") {

            // hide_column_list = home_re_hide_column_list;
            hide_columns_json = home_re_hide_columns_json;
            max_columns = home_re_number_of_columns;
            // temp_button = "re_show_hide_columns_button";

        } else if (prefix === "te") {

            // hide_column_list = home_te_hide_column_list;
            hide_columns_json = home_te_hide_columns_json;
            max_columns = home_te_number_of_columns;
            // temp_button = "te_show_hide_columns_button";

        } else if (prefix === "tl") {

            // hide_column_list = home_tl_hide_column_list;
            hide_columns_json = home_tl_hide_columns_json;
            max_columns = home_tl_number_of_columns;
            // temp_button = "tl_show_hide_columns_button";

        }

        if (hide_columns_json === undefined) {
            // this will be undefined for the date_table if the user has not entered any column preferences for the table
        } else {

            if (hide_columns_json === '[]' || hide_columns_json === '' || hide_columns_json === "") {
                // alert("1604 empty json");
            } else {

                var temp_json_str = $.parseJSON(hide_columns_json);  // comma separated list of strings

                var temp_array = temp_json_str.split(",");

                if (Number(max_columns) == temp_array.length) {
                    // hide the whole table

                    // $('#' + temp_button).prop("disabled", true);

                    $('#td_' + temp_table_id).hide();

                    if (prefix === "pq") {
                        $("#pq_show_hide_checkbox").prop('checked', false);
                    } else if (prefix === "qa") {
                        $("#qa_show_hide_checkbox").prop('checked', false);
                    } else if (prefix === "qi") {
                        $("#qi_show_hide_checkbox").prop('checked', false);
                    } else if (prefix === "re") {
                        $("#re_show_hide_checkbox").prop('checked', false);
                    } else if (prefix === "te") {
                        $("#te_show_hide_checkbox").prop('checked', false);
                    } else if (prefix === "tl") {
                        $("#tl_show_hide_checkbox").prop('checked', false);
                    }

                } else {

                    var oTable = $('#' + temp_table_id).dataTable();

                    for (var index = 0; index < temp_array.length; index++) {

                        var column_number = temp_array[index].trim();
                        oTable.fnSetColumnVis(Number(column_number) - 1, false, false);

                    }
                    oTable.fnDraw();
                }
            }
        }

    }

    // the column names to hide are entered in the column preferences table
    function hide_user_column_preferences_by_column_name(temp_table_id, prefix) {

        var hide_columns_json;
        // var hide_column_list;

        var max_columns = 0;
        // var temp_button;

        if (prefix === "pq") {

            // hide_column_list = home_pq_hide_column_list;
            hide_columns_json = home_pq_hide_columns_json;
            max_columns = home_pq_number_of_columns;
            // temp_button = "pq_show_hide_columns_button";

        } else if (prefix === "qa") {

            // hide_column_list = home_qa_hide_column_list;
            hide_columns_json = home_qa_hide_columns_json;
            max_columns = home_qa_number_of_columns;
            // temp_button = "qa_show_hide_columns_button";

        } else if (prefix === "qi") {

            // hide_column_list = home_qi_hide_column_list;
            hide_columns_json = home_qi_hide_columns_json;
            max_columns = home_qi_number_of_columns;
            // temp_button = "qi_show_hide_columns_button";

        } else if (prefix === "re") {

            // hide_column_list = home_re_hide_column_list;
            hide_columns_json = home_re_hide_columns_json;
            max_columns = home_re_number_of_columns;
            // temp_button = "re_show_hide_columns_button";

        } else if (prefix === "te") {

            // hide_column_list = home_te_hide_column_list;
            hide_columns_json = home_te_hide_columns_json;
            max_columns = home_te_number_of_columns;
            // temp_button = "te_show_hide_columns_button";

        } else if (prefix === "tl") {

            // hide_column_list = home_tl_hide_column_list;
            hide_columns_json = home_tl_hide_columns_json;
            max_columns = home_tl_number_of_columns;
            // temp_button = "tl_show_hide_columns_button";

        }

        if (hide_columns_json === undefined) {
            // this will be undefined for the date_table if the user has not entered any column preferences for the table
        } else {

            if (hide_columns_json === '[]' || hide_columns_json === '' || hide_columns_json === "") {
                // alert("1604 empty json " + temp_table_id);
            } else {

                var temp_json_str = $.parseJSON(hide_columns_json);  // comma separated list of strings

                var temp_array = temp_json_str.split(",");

                if (Number(max_columns) == temp_array.length) {
                    // hide the whole table

                    // $('#' + temp_button).prop("disabled", true);

                    $('#td_' + temp_table_id).hide();

                    if (prefix === "pq") {
                        $("#pq_show_hide_checkbox").prop('checked', false);
                    } else if (prefix === "qa") {
                        $("#qa_show_hide_checkbox").prop('checked', false);
                    } else if (prefix === "qi") {
                        $("#qi_show_hide_checkbox").prop('checked', false);
                    } else if (prefix === "re") {
                        $("#re_show_hide_checkbox").prop('checked', false);
                    } else if (prefix === "te") {
                        $("#te_show_hide_checkbox").prop('checked', false);
                    } else if (prefix === "tl") {
                        $("#tl_show_hide_checkbox").prop('checked', false);
                    }

                } else {

                    // create a list of column_numbers to hide then call the fnSetColumnVis
                    var column_number_list = [];

                    for (var index01 = 0; index01 < temp_array.length; index01++) {

                        var column_name = temp_array[index01].trim();
                        var column_number = get_column_number_by_name(temp_table_id, prefix, column_name);

                        // if the user has entered a column name that cannot be found in the table, the column_number will be -1
                        if (column_number > -1) {

                            if ($.inArray(column_number, column_number_list) == -1) {
                                column_number_list.push(column_number);
                            }

                        }
                    }

                    var oTable = $('#' + temp_table_id).dataTable();

                    for (var index02 = 0; index02 < column_number_list.length; index02++) {

                        var hide_column_number = column_number_list[index02];
                        oTable.fnSetColumnVis(Number(hide_column_number), false, false);

                    }
                    oTable.fnDraw();
                }
            }
        }
    }

    function get_column_number_by_name(temp_table_id, prefix, column_name) {

        var column_number = -1;

        $('#' + temp_table_id).find('th').each(function($index) {
            var temp_name = $(this).text().trim();

            if (temp_name === column_name) {
                column_number = $index;
            }
        });

        return column_number;
    }

    // if the number of visible tables equals zero, hide the date table
    function show_hide_date_table() {

        var visible_tables = 0;

        if ($('#product_quality_table').is(':visible')) {
            visible_tables++;
        }
        if ($('#quality_assurance_table').is(':visible')) {
            visible_tables++;
        }
        if ($('#quality_innovation_table').is(':visible')) {
             visible_tables++;
        }
        if ($('#requirements_engineering_table').is(':visible')) {
            visible_tables++;
        }
        if ($('#test_engineering_table').is(':visible')) {
            visible_tables++;
        }
        if ($('#test_lab_table').is(':visible')) {
            visible_tables++;
        }

        // this works but I need the number of visible tables to adjust the table sizing
        /*
        if ($('#product_quality_table').is(':visible') || $('#quality_assurance_table').is(':visible') ||
            $('#quality_innovation_table').is(':visible') || ($('#requirements_engineering_table').is(':visible') ||
            $('#test_engineering_table').is(':visible') || $('#test_lab_table').is(':visible'))) {

            $("#td_date_table").show();
        } else {
            $("#td_date_table").hide();
        }
        */

        if (visible_tables == 0) {

            // $("#td_date_table").hide();

            $("#west_table_wrapper_div.table-responsive").css('overflow-x', 'hidden');

            // hide the div for the drop target
            $("#dnd_div_home").hide();

        } else {

            // $("#td_date_table").show();

            $("#west_table_wrapper_div.table-responsive").css('overflow-x', 'auto');

            $("#dnd_div_home").show();

        }

    }

    // end of show or hide section

</script>

{% endblock %}
